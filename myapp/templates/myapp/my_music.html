{% extends "myapp/base.html" %}
{% load static %}
{% block content %}
  <h1 style="font-size: 36px; font-weight: 700; margin: 0 0 32px 0;">My Music</h1>
  
  {% if albums_with_rankings %}
    <div class="grid grid-albums-large">
      {% for item in albums_with_rankings %}
        {% with saved_album=item.saved_album latest_ranking=item.latest_ranking %}
          <div class="card">
            <div style="display:flex;gap:12px;margin-bottom:16px">
              {% if saved_album.cover_image %}
                <img src="{{ saved_album.cover_image }}" alt="{{ saved_album.album_name }}" style="width:80px;height:80px;object-fit:cover;border-radius:var(--radius-sm);flex-shrink:0">
              {% else %}
                <div style="width:80px;height:80px;background:#f5f5f5;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;color:#666666;flex-shrink:0">
                  No Image
                </div>
              {% endif %}
              <div style="flex:1;min-width:0">
                <h3 style="margin:0;font-size:16px;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:#000000">{{ saved_album.album_name }}</h3>
                <p style="margin:4px 0 0 0;color:#333333;font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">{{ saved_album.artist_name }}</p>
                <p style="margin:4px 0 0 0;color:#666666;font-size:12px">Saved {{ saved_album.saved_at|date:"M d, Y" }}</p>
              </div>
            </div>
            
            {% if latest_ranking %}
              <p style="margin:0 0 16px 0;color:#666666;font-size:13px">
                Last ranked: {{ latest_ranking.created_at|date:"M d, Y" }} ({{ latest_ranking.comparisons_count }} comparisons)
              </p>
            {% else %}
              <p style="margin:0 0 16px 0;color:#666666;font-size:13px">No ranking yet</p>
            {% endif %}
            
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              {% if latest_ranking %}
                <a href="{% url 'myapp:rank_result' saved_album.album_id %}" class="btn btn-primary btn-small">View Result</a>
              {% endif %}
              <a href="{% url 'myapp:rank' saved_album.album_id %}" class="btn btn-secondary btn-small">
                {% if latest_ranking %}Re-rank{% else %}Rank{% endif %}
              </a>
              <button class="remove-btn btn btn-danger btn-small" data-album-id="{{ saved_album.album_id }}">Remove</button>
            </div>
          </div>
        {% endwith %}
      {% endfor %}
    </div>
  {% else %}
    <div class="empty-state">
      <h3>No albums saved yet</h3>
      <p>Go rank something ğŸ”¥</p>
      <a href="{% url 'myapp:search' %}" class="btn btn-primary" style="margin-top:24px">Search Albums</a>
    </div>
  {% endif %}

  <script>
    const csrfToken = "{{ csrf_token }}";
  </script>
  <script src="{% static 'myapp/js/my_music.js' %}"></script>
{% endblock %}

