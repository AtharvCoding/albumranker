{% extends "myapp/base.html" %}
{% load static %}
{% block content %}
  <h1>My Music</h1>
  
  {% if albums_with_rankings %}
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin-top:24px">
      {% for item in albums_with_rankings %}
        {% with saved_album=item.saved_album latest_ranking=item.latest_ranking %}
          <div class="album-card" style="border:1px solid #e5e7eb;border-radius:12px;padding:16px;background:#fff">
            <div style="display:flex;gap:12px;margin-bottom:12px">
              {% if saved_album.cover_image %}
                <img src="{{ saved_album.cover_image }}" alt="{{ saved_album.album_name }}" style="width:80px;height:80px;object-fit:cover;border-radius:6px">
              {% endif %}
              <div style="flex:1;min-width:0">
                <h3 style="margin:0;font-size:16px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">{{ saved_album.album_name }}</h3>
                <p style="margin:4px 0 0 0;color:#6b7280;font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">{{ saved_album.artist_name }}</p>
                <p style="margin:4px 0 0 0;color:#9ca3af;font-size:12px">Saved {{ saved_album.saved_at|date:"M d, Y" }}</p>
              </div>
            </div>
            
            {% if latest_ranking %}
              <p style="margin:0 0 12px 0;color:#6b7280;font-size:13px">
                Last ranked: {{ latest_ranking.created_at|date:"M d, Y" }} ({{ latest_ranking.comparisons_count }} comparisons)
              </p>
            {% else %}
              <p style="margin:0 0 12px 0;color:#9ca3af;font-size:13px">No ranking yet</p>
            {% endif %}
            
            <div style="display:flex;gap:6px;flex-wrap:wrap">
              {% if latest_ranking %}
                <a href="{% url 'myapp:rank_result' saved_album.album_id %}" style="padding:6px 12px;background:#111;color:#fff;border-radius:6px;text-decoration:none;font-size:13px">View Result</a>
              {% endif %}
              <a href="{% url 'myapp:rank' saved_album.album_id %}" style="padding:6px 12px;background:#e5e7eb;color:#111;border-radius:6px;text-decoration:none;font-size:13px">
                {% if latest_ranking %}Re-rank{% else %}Rank{% endif %}
              </a>
              <button class="remove-btn" data-album-id="{{ saved_album.album_id }}" style="padding:6px 12px;background:#fee2e2;color:#dc2626;border:0;border-radius:6px;cursor:pointer;font-size:13px">Remove</button>
            </div>
          </div>
        {% endwith %}
      {% endfor %}
    </div>
  {% else %}
    <div style="padding:40px;text-align:center;color:#6b7280">
      <p>You haven't saved any albums yet.</p>
      <a href="{% url 'myapp:search' %}" style="margin-top:12px;display:inline-block;padding:10px 14px;background:#111;color:#fff;border-radius:6px;text-decoration:none">Search Albums</a>
    </div>
  {% endif %}

  <script>
    const csrfToken = "{{ csrf_token }}";
  </script>
  <script src="{% static 'myapp/js/my_music.js' %}"></script>
{% endblock %}

